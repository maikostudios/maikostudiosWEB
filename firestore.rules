rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Función helper para verificar si el usuario es administrador
    function isAdmin() {
      return request.auth != null && 
        request.auth.token.email in [
          'maikostudios@gmail.com',
          'contacto@maikostudios.com'
        ];
    }
    
    // Mensajes de contacto
    match /mensajes_contacto/{document} {
      // Permitir creación pública (formularios de contacto)
      allow create: if true;
      
      // Solo administradores pueden leer, actualizar y eliminar
      allow read, update, delete: if isAdmin();
    }
    
    // Solicitudes de CV personalizado
    match /solicitudes_cv/{document} {
      // Permitir creación pública (formulario de CV)
      allow create: if true;
      
      // Solo administradores pueden leer, actualizar y eliminar
      allow read, update, delete: if isAdmin();
    }
    
    // Estadísticas de visitas
    match /visitas/{document} {
      // Permitir creación para tracking de visitas
      allow create: if true;
      
      // Solo administradores pueden leer
      allow read: if isAdmin();
      
      // No permitir actualización ni eliminación
      allow update, delete: if false;
    }
    
    // Configuración del sitio (para futuras funcionalidades)
    match /configuracion/{document} {
      // Solo administradores pueden gestionar configuración
      allow read, write: if isAdmin();
    }
    
    // Logs del sistema (para debugging)
    match /logs/{document} {
      // Permitir creación para logging automático
      allow create: if true;
      
      // Solo administradores pueden leer
      allow read: if isAdmin();
      
      // No permitir modificación de logs
      allow update, delete: if false;
    }
  }
}
